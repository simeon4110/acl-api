/*
 Handles all the administrative functions.

 Author: Josh Harkema
 Date: 27 June 2018
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");
var table=$("#users").DataTable({ajax:{url:"/admin/user/all",dataSrc:""},columns:[{mData:"username"},{mData:"admin"},{mData:"addedAt",render:function(a,b,c){return"sort"===b||"type"===b?a:moment(a).format("MM-DD-YYYY")}},{mData:"username",fnCreatedCell:function(a,b,c,d,e){$(a).html("<button type='button' class='btn btn-primary btn-sm' data-toggle='modal'data-target='#resetModal' data-user='"+b+"'>Reset Password</button>")}},{mData:"username",fnCreatedCell:function(a,b,c,d,e){$(a).html("<button type='button' class='btn btn-primary btn-sm' data-toggle='modal'data-target='#modifyModal' data-user='"+
b+"'>Modify User</button>")}},{mData:"username",fnCreatedCell:function(a,b,c,d,e){$(a).html("<button type='button' class='btn btn-danger btn-sm' data-toggle='modal'data-target='#deleteModal' data-user='"+b+"'>Delete User</button>")}}]});$("#resetModal").on("show.bs.modal",function(a){a=$(a.relatedTarget).data("user");$(this).find(".modal-title").text("Reset password for: "+a);$("#resetUsername").val(a);$("#password").val("");$("#password1").val("")});
$("#modifyModal").on("show.bs.modal",function(a){var b=$(a.relatedTarget).data("user"),c=$(this);$.ajax({url:"/admin/user/get/"+b,dataType:"json",success:function(a){c.find(".modal-title").text("Modifying user: "+b);console.log(a);$("#modifyUsername").val(b);$("#email").val(a.email);!0===a.admin?$("#isAdmin select").val("true"):$("#isAdmin select").val("false")},fail:function(){$("#failModal").modal("toggle")}})});
$("#deleteModal").on("show.bs.modal",function(a){a=$(a.relatedTarget).data("user");$(this).find(".modal-title").text("Delete "+a+"?");$("#deleteUsername").val(a)});
function resetPassword(){var a=$("#resetUsername").val(),b=$("#password").val(),c=$("#password1").val();a={username:a,password:b,password1:c};$("#resetModal").modal("toggle");$.ajax({url:"/admin/user/modify/password",type:"put",data:JSON.stringify(a),headers:{"Content-Type":"application/json"},dataType:"json",statusCode:{202:function(){$("#successModal").modal("toggle");table.ajax.reload()},406:function(){$("#failModal").modal("toggle")}}})}
function modifyUser(){var a=$("#modifyUsername").val(),b=$("#email").val(),c=$("#isAdmin").val();a={username:a,email:b,admin:c};$("#modifyModal").modal("toggle");$.ajax({url:"/admin/user/modify",type:"put",data:JSON.stringify(a),headers:{"Content-Type":"application/json"},dataType:"json",statusCode:{202:function(){$("#successModal").modal("toggle");table.ajax.reload()},406:function(){$("#failModal").modal("toggle")}}})}
function deleteUser(){var a={username:$("#deleteUsername").val()};$("#deleteModal").modal("toggle");$.ajax({url:"/admin/user/delete",type:"delete",data:JSON.stringify(a),headers:{"Content-Type":"application/json"},dataType:"json",statusCode:{202:function(){$("#successModal").modal("toggle");table.ajax.reload()},406:function(){$("#failModal").modal("toggle")}}})};
